<link rel="stylesheet" href="/css/home.css">

<div id="home-container">
    <section id="feed-posts">
        <h4>Posts</h4>
        <%if(locals.user){%>
            <!-- form to create post -->
        <form action="/posts/create" id="new-post-form" method="post">
            <textarea name="content" cols="30" rows="3" placeholder="Type Here...." required></textarea>
            <input type="submit" value="Post">
        </form>
        <%}%>
        <div id="post-list-container">
            <ul>
                <!-- i represents post object -->
                <!-- this 'post' name we get from home_controller.js' -->
                <!-- we cannot use original post_Schema name in ejs part so we write it in new key -->
            <%for(let i of post){%>
                
                <li id="post-<%=i.id%>">
                    <p>
                      
                       <% if(locals.user && i.user.id==locals.user.id){%>
                           <small>
                               <!-- i.id is id of that post -->
                               <a class="delete-post-button" href="/posts/destroy/<%= i.id %>">Delete</a>
                               
                           </small>
                           <%}%>

                       <%=i.content%>
                   <br>  
                    <small>
                       <%=i.user.Name%>
                   </small>
                </p>
                <div class="post-comments">
                   <%if(locals.user){%>
                    <!-- form to create comment -->
                   <form action="/comments/create" method="post" id="post-<%=i._id%>-comments-form">
                       <input type="text" name="content" placeholder="Type Here to add comment......" required>
                       <!-- value attribute -> the content in the value set is sent to the server on form submission.-->
                       <!--value="<%=i._id%> is the id of post in which comment is created-->
                       <input type="hidden" name="post" value="<%=i._id%>">
                       <input type="submit" value="Add Comment">
                   </form>
                   <%}%>
                
                   <div id="post-comments-lists">
                       <ul id="post-comments-<%=i._id%>">
                           <!-- i.comments is loop inside comments of posts(in which p represents that object) -->
                           <%for(let p of i.comments){%>
                           
                            <li id="comment-<%=p.id%>">
                                <p>
                                   
                                    <% if(locals.user && locals.user.id==p.user.id){%>
                                        <small>
                                            <!-- p.id is id of that comment -->
                                            <a class="delete-comment-button" href="/comments/destroy/<%= p.id %>">Delete</a>
                                        </small>
                                        <%}%>
                                   <%=p.content%>
                                    <br>
                                    <small>
                                        <%=p.user.Name%>
                                    </small>
                                </p>
                            </li>              
                
                           <%}%>
                
                       </ul>
                   </div>
                </div>
                </li>
                        
            <%}%>
        </ul>
        </div>
    </section>
    
    <!-- displaying users friends -->
    <section id="user-friends">
        <h4>Friends</h4>
        <!-- this 'all_users' name we get from home_controller.js' -->
         <!-- we cannot use original user_Schema name in ejs part so we write it in new key -->
        <%for(u of all_users){%>
        <p>
            <a href="/user/profile/<%=u.id%>"><%=u.Name%></a>
        </p>
        <%}%>
    </section>

</div>
<script src="/js/home_comment.js"></script>
<script src="/js/home_post.js"></script>
